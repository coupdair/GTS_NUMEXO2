##example
# - SCAN passive
# - ->val float
# - add sub:
#   1. dbSubExample.c:
#     - func(
#     - epicsRegisterFunction(func
      o or use func*ArgEPICS
#   2. dbSubExample.dbd:
#     - function(func
#   3. dbSubExample.db:
#     - field(SNAM,"func
#   o. see gtsApp/src/funcEPICS.sh

#edit
gitk --all &
gedit _info.txt gtsApp/src/gtsMain.cpp gtsApp/src/dbSubExample.c iocBoot/iocgts/gts.cmd &
##current
gedit _info.txt gtsApp/src/gtsMain.cpp gtsApp/src/dbSubExample.c iocBoot/iocgts/st.cmd xmmregs_l.h trigger.c xmmregs_Trigger.c &
cd ~/GTS_server/GTS_EPICS/GTS_VxWorks/gtsApp/src/
gedit trigger.c ../../vxworks/shared/ppc405_0_drv_csp/xlowlevel/xmmregs_Trigger.c ../../vxworks/v3/ppc405_0_drv_csp/xlowlevel/xmmregs_l.h &
cd ~/GTS_server/GTS_EPICS/GTS_client/src/
gedit do_tree.c ../../../GTS_EPICS/GTS_VxWorks/gtsApp/src/align_tree.c ../../../GTS_EPICS/GTS_VxWorks/vxworks/v3/ppc405_0_drv_csp/xlowlevel/xmmregs_RocketIO.c trigger.c lib_align.c &


#GTS (EPICS or UDP)
./make.sh

#documentation
./doxygen.sh

#transfert
./pack.sh

#run
##x86
./gts_linux-x86_64.sh
##or in background
screen -dmS epics ./gts_linux-x86_64.sh
# v
dbl
gts127:subExample
gts127:gtsExample
Record gts127:subExample called mySubProcess(0x22fbb10/1.000000) #0 S1
...
# v
from epics import PV
lat=PV('gts127:getLatency')
print lat.get()
print lat.put(1)

Record gts127:getLatency called getLatencyEPICS(0x1ce4fe0/1.000000)activated_if_1
gts fake: EPICS/getLatencyEPICS(subRecord *)


##ppc
###crate ON
snmpset -v 2c -m +WIENER-CRATE-MIB -c private 10.10.18.61 sysMainSwitch.0 i 1
###GTS run interactive
./gts --epics -c gts.cmd -i 27
###or
cat /GTSid
/usr/local/bin/gts.sh
###or from remote
id=27; ip=127; ssh numexo2@10.10.17.$ip "su -c 'echo '$id' > /GTSid'"
ssh numexo2@numexo2-27 "su -c '/usr/local/bin/gts.sh'"

##x86 server
setenv EPICS_CA_ADDR_LIST '10.10.17.127'
#setenv EPICS_CA_AUTO_ADDR_LIST 'NO'

##PPC server
setenv EPICS_CA_ADDR_LIST '10.10.17.254'
setenv EPICS_CAS_BEACON_ADDR_LIST '10.10.17.254'

caget gts127:serverVersion.DESC
gts127:serverVersion.DESC     v0.2.5j

caget gts127:alignMeas.DESC
gts127:alignMeas.DESC         alignMeas(forward,nmes)

caput gts127:alignMeas 0      #call gts127:alignMeas(0)
caput gts127:alignMeas.A 1    #call gts127:alignMeas(0)
caput gts127:alignMeas.B 123  #call gts127:alignMeas(0)
caput gts127:alignMeas 1      #call gts127:alignMeas(1)


epics> dbl
gts127:subExample
gts127:gtsExample
gts127:serverVersion
gts127:gtsReset
gts127:gtsInit
gts127:gtsTest
gts127:gtsUpdate
gts127:conIs
gts127:gtsIs
gts127:treeStart
gts127:treeStop
gts127:includeCarrierForAlign
gts127:excludeCarrierForAlign
gts127:alignStart
gts127:treeSetup
gts127:rxSystemIsReady
gts127:treeRead
gts127:fineDelaySetNow
gts127:fineDelaySet
gts127:coarseDelaySet
gts127:triggerStart
gts127:alignSet
gts127:alignMeas
gts127:triggerSetup
gts127:tdcSet
gts127:tdcMeas
gts127:transCon
gts127:transGtsTree
gts127:transDigitizer
gts127:alignTdcSet
gts127:printBinary
gts127:testSet
gts127:testUnSet
gts127:triggerCoreStart
gts127:triggerCoreStop
gts127:triggerCoreReset
gts127:setIdlePeriod
gts127:setIdleEnabled
gts127:exclude_trigger_processor
gts127:include_trigger_processor
gts127:requestRateGet
gts127:validationRateGet
gts127:rejectionRateGet
gts127:backpressureRateGet
gts127:getLatency
gts127:triggerGetRates

#Version in DESC, F and (A.B.CD)
epics> dbpr gts127:serverVersion
A: 0                ASG:                B: 2                C: 5                
D: 0                DESC: v0.2.5        DISA: 0             DISP: 0             
DISV: 1             E: 0                F: 0.2              G: 0                
...
epics>

#AGATA
./gts_client.sh
##OK, up to the end

exit

#clean
rm -fr configure include iocBoot gtsApp lib db dbd Makefile bin

#example
/space/global/buildroot/CentOS6_64/ppc440/epics/base/bin/linux-x86_64/makeBaseApp.pl -t example gts
/space/global/buildroot/CentOS6_64/ppc440/epics/base/bin/linux-x86_64/makeBaseApp.pl -t example -i -p gts -a linux-x86_64 gts
make

#a few random
Kernel panic - not syncing: Fatal exception in interrupt

